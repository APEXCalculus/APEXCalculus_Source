\begingroup \toks 0={macro:-> \begin {axis}[ width=\marginparwidth +25pt,tick label style={font=\scriptsize },axis on top, axis y line=none, axis lines=center, y dir=reverse, name=myplot, xtick={1,2,3}, ztick=\empty ,ymin=-1,ymax=1,xmin=-1.2,xmax=1.2, zmin=-.1,zmax=1.2] \par \par \par \addplot 3[domain=0:.5,y domain=-220:140,surf,colormap={mp2}{\colormapplaneone },opacity=.8,faceted color=black!40,samples=8,samples y=36,very thin,z buffer=sort] ({cos(y)},{sin(y)},{x}); \par \addplot 3[domain=0:1,y domain=-180:180,surf,colormap={mp2}{\colormapplaneone },opacity=.8,faceted color=black!40,samples=8,samples y=36,very thin,z buffer=sort] ({cos(y)*x},{sin(y)*x},{1/(1+x^2)}); \par \par \addplot 3[domain=0:1,samples y=0,black,thick,smooth,] ({x},{0},{1/(1+x^2)}); \addplot 3[domain=-50:150,samples y=0,smooth,] ({cos(x)},{sin(x)},{.5}); \par \addplot 3[domain=150:310,samples y=0,smooth,dashed] ({cos(x)},{sin(x)},{.5}); \par \addplot 3[domain=-30:150,samples y=0,smooth,] ({cos(x)},{sin(x)},{0}); \par \addplot 3[domain=150:315,samples y=0,smooth,dashed] ({cos(x)},{sin(x)},{0}); \par \draw [thick] (axis cs:1,0,.5) -- (axis cs:1,0,0) -- (axis cs:0,0,0) -- (axis cs:0,0,1); \par \par \end {axis} \par \node [right] at (myplot.right of origin)[shift={(-20pt,-8pt)}] {\scriptsize $x$}; \node [above] at (myplot.above origin) [shift={(0,-23pt)}] {\scriptsize $y$}; }\xdef \tikzexternallastkey {\the \toks 0 }\endgroup %
